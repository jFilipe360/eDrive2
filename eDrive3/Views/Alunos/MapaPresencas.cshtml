@{
    var presencasTeoricas = ViewBag.PresentesPorNumeroTeorico as HashSet<int> ?? new HashSet<int>();
    var numerosTeoricos = ViewBag.NumerosTeoricos as List<int> ?? Enumerable.Range(1, 28).ToList();
    var presencasPraticas = ViewBag.PresentesPorNumeroPratico as HashSet<int> ?? new HashSet<int>();
    var numerosPraticos = ViewBag.NumerosPraticos as List<int> ?? Enumerable.Range(1, 32).ToList();
    var errorMsg = TempData["Error"] as string;

    ViewData["Title"] = "Mapa de Presenças";
}

@if (!string.IsNullOrEmpty(errorMsg))
{
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="errToast" class="toast align-items-center text-bg-warning border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    @errorMsg
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            const t = new bootstrap.Toast(document.getElementById('errToast'), { delay: 5000 });
            t.show();
        });
    </script>
}

<h1>Marcar Presenças</h1>

<h3>Aulas Teóricas</h3>
<table class="table table-bordered text-center" style="max-width:600px;">
    @for (int row = 0; row < 7; row++)
    {
        <tr>
            @for (int col = 0; col < 4; col++)
            {
                int numero = row * 4 + col + 1;
                bool presente = presencasTeoricas.Contains(numero);
                string bgColor = presente ? "#3bb54a" : "#ffe066";
                <td style="background-color:@bgColor; font-weight:600; width:60px; height:60px; vertical-align:middle;">
                    @if (presente)
                    {
                        @numero
                    }
                    else
                    {
                        <a asp-controller="Presencas"
                           asp-action="MarcarPorNumero"
                           asp-route-numero="@numero"
                           style="display:block; color:black; text-decoration:none;">
                            @numero
                        </a>
                    }
                </td>
            }
        </tr>
    }
</table>

<h3>Aulas Práticas</h3>
<table class="table table-bordered text-center" style="max-width:600px;">
    @for (int row = 0; row < 8; row++)
    {
        <tr>
            @for (int col = 0; col < 4; col++)
            {
                int numero = row * 4 + col + 1;
                bool presente = presencasPraticas.Contains(numero);
                string bgColor = presente ? "#3bb54a" : "#ffe066"; // verde se presença confirmada, amarelo se ainda não
                <td style="background-color:@bgColor; font-weight:600; width:60px; height:60px; vertical-align:middle;">
                    @numero
                </td>
            }
        </tr>
    }
</table>
